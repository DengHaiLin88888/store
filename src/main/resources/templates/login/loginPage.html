<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>去哪儿</title>
    <link rel="shortcut icon" type="image/x-icon" href="/picture/pageShow2.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css">
    <link rel="stylesheet" href="/css/loginPageTwo.css">
</head>
<body>
    <div class="container right-panel-active">

        <!-- 注册页面 -->
        <div class="container-form container-signup">
            <form action="" class="form">
                <h2 class="form-title"><strong>生活馆</strong></h2>
                <input type="text" id="idNumberRegister" required readonly placeholder="账号" class="input">
                <input type="email" id="email" name="email" required placeholder="邮箱" class="input">
                <input type="text" placeholder="验证码" id="checkCode" name="checkCode" required class="input">
                <input type="password" placeholder="账号密码" id="passwordRegister" name="password"  required class="input">
                <button class="submit" type="button" id="registerRegister">注 册</button>
                <a style="position: relative;top: -248px" class="sendEmail" id="sendAuthCodeEmail" href="##">发送验证码</a>
            </form>
        </div>

        <!-- 登录页面 -->
        <div class="container-form container-signin">
            <form action="/loginSys" id="loginForm" method="post" class="form">
                <h2 class="form-title"><strong>生活馆</strong></h2>
                <input type="text" placeholder="账号" required id="idNumber" name="idNumber" class="input">
                <input type="password" placeholder="密码" required id="password" name="password" class="input">
                <label class="loginError" th:if="${param.error}"
                       th:text="${session.SPRING_SECURITY_LAST_EXCEPTION.message}">
                </label>
                <a class="link" href="javascript:void(0);">忘记密码？</a>
                <button class="submit" type="button" id="loginTest">登 录</button>
            </form>
        </div>

        <!-- 覆盖层 -->
        <div class="container-overlay">
            <div class="overlay">
                <div class="overlay-slide overlay-left">
                    <button class="submit" id="goSignIn">登 录</button>
                </div>
                <div class="overlay-slide overlay-right">
                    <button class="submit" id="goSignUp">注 册</button>
                </div>
            </div>
        </div>
    </div>

</body>
<script type="text/javascript" src="/js/jquery-3.3.1.min.js"></script>
<script type="text/javascript" src="../layui/layui.js"></script>
<script>
    window.addEventListener('load',()=>{
        // 我们需要获取两个切换按钮 因此需要到html结构中 定义特殊类名或id名
        const goSignIn = document.querySelector('#goSignIn');
        const goSignUp = document.querySelector('#goSignUp');
        // 获取被切换的样式类
        const container = document.querySelector('.container');
        // 添加点击事件
        goSignIn.addEventListener('click',()=>{
            container.classList.remove('switch');
        })
        goSignUp.addEventListener('click',()=>{
            // 填充将要被注册的账号
            $.ajax({
                type:"post",
                url : "/login/getNextIdNumber",
                async:false,
                success:function (data) {
                    $('#idNumberRegister').val(data)
                }
            })
            container.classList.add('switch');
        })
        // 原理：通过点击goSignIn登录页按钮时 就删除switch这个类名
        // 因为之前已经定义好了样式 删除switch类名 就会恢复成没有设置包含switch类
        // 反之点击goSignUp 就会添加switch类名 显示我们默认页面
        // 可以看到页面没有加过渡效果 继续前往css设置把！
    })

    $('#loginTest').click(function () {
        // 账号
        var idNumber = $('#idNumber').val();
        if(idNumber == null || idNumber == ''){
            layer.msg('请输入登录账号', {
                // 2s后自动关闭
                time: 2000,
            });
            return;
        }

        // 密码
        var password = $('#password').val();
        if(password == null || password == ''){
            layer.msg('请输入登录密码', {
                // 2s后自动关闭
                time: 2000,
            });
            return;
        }

        $('#loginForm').submit();
    })

    // 发送验证码
    $('#sendAuthCodeEmail').click(function () {
        // 邮箱
        var email = $('#email').val();

        if(email == null || email == ''){
            layer.msg('请输入注册邮箱', {
                // 2s后自动关闭
                time: 2000,
            });
            return;
        }
        // 发送验证码
        $.ajax({
            type:"post",
            url : "/login/checkCode",
            async:false,
            data : {
                email : email,
            },
            success:function (data) {
                layer.msg(data.message, {
                    // 2s后自动关闭
                    time: 2000,
                });
            }
        })
    })

    // 点击注册
    $('#registerRegister').click(function () {
        // 账号
        var idNumber = $('#idNumberRegister').val();

        // 邮箱
        var email = $('#email').val();
        if(email == null || email == ''){
            layer.msg('请输入注册邮箱', {
                // 2s后自动关闭
                time: 2000,
            });
            return;
        }
        // 验证码
        var authCode = $('#checkCode').val();
        if(email == null || authCode == ''){
            layer.msg('请输入注册验证码', {
                // 2s后自动关闭
                time: 2000,
            });
            return;
        }
        // 密码
        var password = $('#passwordRegister').val();
        if(password == null || password == ''){
            layer.msg('请输入注册账号密码', {
                // 2s后自动关闭
                time: 2000,
            });
            return;
        }
        // 添加用户
        $.ajax({
            type:"post",
            url : "/login/register",
            async:false,
            data : {
                idNumber : idNumber,
                password : password,
                email : email,
                authCode : authCode
            },
            success:function (data) {
                layer.msg(data.message, {
                    // 1s后自动关闭
                    time: 1000,
                });
            }
        })
    })
</script>
</html>